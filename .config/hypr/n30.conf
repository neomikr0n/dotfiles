# ----------------------------------------------------- 
#█▄░█ ▒▄▀▀▄ ▒▄▀▀▄ 
#█░▀█ ░░▒▀▌ ▒█▄▀█ 
#▀░░▀ ▒▀▄▄▀ ▒█▄▀█ 
# source = ~/.config/hypr/conf/n30.conf
# ----------------------------------------------------- 

monitor=DP-2,3440x1440@240.09,auto,1

# --- SECCIÓN DE ARRANQUE SEGURO ---
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP=Hyprland
exec-once = systemctl --user import-environment WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = /usr/bin/gnome-keyring-daemon --start --components=pkcs11,secrets,ssh
exec-once = systemctl --user mask xdg-desktop-portal-gnome 

# --- VARIABLES DE ENTORNO ---
env = GDK_BACKEND,wayland,x11
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_QPA_PLATFORMTHEME,qt6ct
env = QT_STYLE_OVERRIDE,kvantum
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland
env = ELECTRON_OZONE_PLATFORM_HINT,auto
env = QSG_RHI_BACKEND,opengl
env = QML_DISABLE_DISK_CACHE,1

input {
    kb_layout = latam
    follow_mouse = 1
    numlock_by_default = true
    sensitivity = 0 
    force_no_accel = 0
}

misc {
    vrr = 1
    allow_session_lock_restore = 1 
    session_lock_xray = 1          
}

general {
    gaps_in = 0
    gaps_out = 0,0,0,0
    border_size = 2
    col.active_border = rgba(ffbf00ee) # Ámbar vibrante
    col.inactive_border = rgba(255,255,155,0)
}

animations {
    enabled = true
    bezier = linear, 0, 0, 1, 1
    bezier = md3_standard, 0.2, 0, 0, 1
    bezier = md3_decel, 0.05, 0.7, 0.1, 1
    bezier = md3_accel, 0.3, 0, 0.8, 0.15
    bezier = overshot, 0.05, 0.9, 0.1, 1.1
    bezier = crazyshot, 0.1, 1.5, 0.76, 0.92
    bezier = hyprnostretch, 0.05, 0.9, 0.1, 1.0
    bezier = fluent_decel, 0.1, 1, 0, 1
    bezier = easeInOutCirc, 0.85, 0, 0.15, 1
    bezier = easeOutCirc, 0, 0.55, 0.45, 1
    bezier = easeOutExpo, 0.16, 1, 0.3, 1
    animation = windows, 1, 3, md3_decel, popin 60%
    animation = border, 1, 10, default
    animation = fade, 1, 2.5, md3_decel
    animation = workspaces, 1, 2, easeOutExpo, slide
    animation = specialWorkspace, 1, 2, md3_decel, slidevert
}

render {
    cm_fs_passthrough = 2
}

# --- VARIABLES ---
$files= Thunar
$browser= zen-browser
$whatsapp= zapzap
$music= tidal-hifi
$term= kitty
$editor= antigravity
$mainMod = SUPER
$soundsDir = ~/dotfiles/share/sounds/
$scriptsDir = ~/dotfiles/share/scripts/

# --- WALLPAPER ENGINE ---
$w_cleanup = pkill mpvpaper gslapper 2>/dev/null
exec = $w_cleanup; sleep 1; QSG_RHI_BACKEND=opengl nohup mpvpaper \
  -o "--hwdec=vaapi --vo=gpu --gpu-context=wayland --loop --gamma=-5 --contrast=88 --saturation=79 --brightness=1 --mute=yes --video-unscaled=no --panscan=1" \
  $(hyprctl monitors -j | jq -r '.[0].name') \
  ~/dotfiles/share/wallpapers/yellowmatrix.mp4 > /dev/null 2>&1 & disown

# --- BINDINGS ---
bind = $mainMod, RETURN, exec, $term
bind = $mainMod CTRL, RETURN, exec, dms ipc call spotlight toggle
bind = , F7, exec, flameshot full --clipboard --path ~/Imágenes/Screenshots/ss_$(date +%Y-%m-%d_%H-%M_%S)_garuda.jpeg
bind = $mainMod, F7, exec, flameshot gui --clipboard --path ~/Imágenes/Screenshots/ss_$(date +%Y-%m-%d_%H-%M_%S)_garuda.jpeg
bind = $mainMod Control_R, F7, exec, flameshot full --clipboard --path ~/Imágenes/Screenshots/ss_$(date +%Y-%m-%d_%H-%M_%S)_garuda.png
bind = $mainMod, W, exec, dms ipc call bar toggle index 0
bindr = $mainMod CTRL_R, F1, exec, ddccontrol -r 0x10 -w 40 dev:/dev/i2c-11 && swayosd-client --brightness lower & hyprshade toggle blue-light-filter
bindr = $mainMod CTRL_R, F2, exec, ddccontrol -r 0x10 -w 100 dev:/dev/i2c-11 && swayosd-client --brightness raise & hyprshade toggle blue-light-filter
binde = , xf86audioraisevolume, exec, swayosd-client --output-volume raise
binde = , xf86audiolowervolume, exec, swayosd-client --output-volume lower
bind = , XF86AudioMute, exec, swayosd-client --output-volume mute-toggle
bindr = , KEY_CAPSLOCK, exec, swayosd-client --caps-lock
binde = $mainMod SHIFT, right, resizeactive, 100 0
binde = $mainMod SHIFT, left, resizeactive, -100 0
binde = $mainMod SHIFT, down, resizeactive, 0 100
binde = $mainMod SHIFT, up, resizeactive, 0 -100
bind = $mainMod CTRL SHIFT, left, movewindow, l
bind = $mainMod CTRL SHIFT, right, movewindow, r
bind = $mainMod CTRL SHIFT, up, movewindow, u
bind = $mainMod CTRL SHIFT, down, movewindow, d
bind = ALT, 1, movetoworkspacesilent, 1
bind = ALT, 2, movetoworkspacesilent, 2
bind = ALT, 3, movetoworkspacesilent, 3
bind = ALT, 4, movetoworkspacesilent, 4
bind = ALT, 5, movetoworkspacesilent, 5
bind = ALT, 6, movetoworkspacesilent, 6
bind = ALT, 7, movetoworkspacesilent, 7
bind = ALT, 8, movetoworkspacesilent, 8
bind = ALT, 9, movetoworkspacesilent, 9
bind = ALT, 0, movetoworkspacesilent, 10
bind = $mainMod CTRL, right, exec, hyprctl dispatch workspace e+1 ; play -v 0.1 "$soundsDir/gravity/change_workspace.wav"
bind = $mainMod CTRL, left, exec, hyprctl dispatch workspace e-1 ; play -v 0.1 "$soundsDir/gravity/change_workspace.wav"
bind = ALT, bar, movetoworkspacesilent, special
bindr = $mainMod, $mainMod_L, togglespecialworkspace

# --- WINDOW RULES (ULTRA COMPACT SINGLE LINE) ---
windowrule = opacity 0.6 0.1, match:class Calculator
windowrule = opacity 0.40 0.20, float on, size (700) (380), move (990) (990), match:class org.gnome.Calculator
windowrule = opacity 0.75 0.75, match:class org.kde.dolphin
windowrule = opacity 0.55 0.55, match:class $browser
windowrule = opacity 0.99 0.55, match:class brave
windowrule = opacity 0.85 0.75, match:class $term
windowrule = opacity 0.70 0.70, match:class Thunar
windowrule = opacity 0.70 0.50, match:class whatsapp-for-linux
windowrule = opacity 0.80 0.80, match:class whatsie
windowrule = opacity 0.85 0.85, match:class whatsapp-nativefier
windowrule = opacity 0.85 0.85, match:class com.rtosta.zapzap
windowrule = opacity 0.75 0.65, match:class wasistlos
windowrule = opacity 0.85 0.85, match:class discord
windowrule = opacity 0.55 0.55, match:class easyeffects
windowrule = opacity 0.85 0.85, match:class nz.co.mega.megasync
windowrule = opacity 0.90 0.90, match:class pavucontrol
windowrule = opacity 0.55 0.33, match:class ktimer
windowrule = opacity 0.25 0.11, match:class konsole
windowrule = opacity 0.50 0.50, match:class tidal-hifi
windowrule = opacity 0.80 0.80, match:class luna
windowrule = opacity 0.80 0.70, match:class code-oss
windowrule = opacity 0.90 0.75, match:class code
windowrule = opacity 0.70 0.70, match:class $editor
windowrule = opacity 0.35 0.35, match:title ^(Genymotion)$
windowrule = opacity 0.35 0.35, match:class ^(nz.co.mega.megasync)$
windowrule = opacity 0.80 0.70, match:class MEGAsync
windowrule = opacity 0.95 0.85, match:class Spotify
windowrule = opacity 0.80 0.80, match:class qdirstat
windowrule = opacity 0.80 0.80, match:class qBittorrent
windowrule = opacity 0.80 0.80, match:class org.qbittorrent.qBittorrent
windowrule = opacity 0.99 0.99, match:class steam_app_.*3
windowrule = opacity 0.5 0.6, match:class ^(awakened-poe-trade)$
windowrule = opacity 0.9 0.6, match:class ^([Rr]ofi)$
windowrule = opacity 0.9 0.6, match:class ^([Ss]afe[Ee]yes)$
windowrule = opacity 0.79 0.75, match:class $music
windowrule = opacity 0.80, match:class ^(com.mitchellh.ghostty)$
windowrule = opacity 0.35 0.25, match:class kalk
windowrule = float on, match:class ^(.*org.kde.kalk.*)$
windowrule = float on, match:class ^(hyprland-dialog)$
windowrule = float on, match:title (Extensi.*|.*Bitwarden.*|Open File)
windowrule = workspace 1 silent, match:class ^(wasistlos)$
windowrule = tile on, match:class ^(steam)$
windowrule = move (2) (738), match:class dotfiles-floating
windowrule = move (2900) (60), match:class ^(hyprland-dialog)$
windowrule = move (937) (60), match:title ^(.*Special Offers:.*)$
windowrule = border_size 0, match:class ^(dynisland-daemon|dynisland|zen|steam_app_2399830)$
windowrule = size (150) (276), move (2141) (121), match:class ^(org.kde.kalk)$
windowrule = float on, pin on, move (0) (885), size (982) (553), match:title ^(Picture-in-Picture)$
windowrule = float on, pin on, move (2159) (-8), border_size 0, opacity 0.95 0.95, rounding 40, size (625) (56), match:class Chromium-browser
windowrule = border_size 0, move (3345) (49), match:class dynisland
windowrule = size (420) (698), move (2345) (49), match:title ^(.*Bitwarden.*)$
windowrule = float on, center on, size (700) (300), match:class ^(Thunar)$, match:title ^(Renombrar.*|Bulk Rename.*)$
windowrule = float on, pin on, move (1444) (-11), border_size 0, opacity 0.85 0.85, rounding 40, size (600) (122), match:class io.github.slgobinath.SafeEyes

# --- STARTUP ---
exec-once = bash -c "sleep 25s && hyprctl dispatch exec '[workspace special silent] $music'"
exec-once = [workspace special silent] $term -e -o font_size=10 btop
exec-once = bash -c "sleep 5; hyprctl dispatch exec '[workspace 3 silent] $files'"
exec-once = [workspace 5 silent] copyq
exec-once = [workspace 5 silent] ksnip
exec-once = [workspace 5 silent] corectrl
exec-once = [workspace 6 silent] megasync
exec-once = bash -c "sleep 20s && hyprctl dispatch exec '[workspace special silent] steam'"
exec-once = sleep 22s && hyprctl dispatch movetoworkspacesilent 1, class:steam
exec-once = hyprctl dispatch workspace 2
exec-once = sleep 10s && hyprctl dispatch exec "[workspace 1 silent]" QT_QUICK_BACKEND=software $whatsapp 
exec-once = sleep 7s && hyprctl dispatch exec "[workspace 2 silent]" $browser
exec-once = sleep 3s && hyprctl dispatch exec "[workspace 2 silent]" $editor
exec-once = wl-paste --type text --watch cliphist store
exec-once = bash -c "sleep 10; rclone mount 'koofr:/koofr/Autosync' /home/n30/Autosync/ --vfs-cache-mode full &"
exec = ddccontrol -r 0x10 -w 100 dev:/dev/i2c-110
bind = $mainMod, N, exec, swaync-client -t -sw
bind = SUPER, L, exec, $scriptsDir/screenlock.sh 
bind = $mainMod CTRL ALT, W, exec, killall mpvpaper
bind = $mainMod CTRL ALT, A, exec, pkill -9 -i -f "ArkAscended|ShooterGame"

# --- ZOOM CONTROLS ---
bind = $mainMod CTRLx, mouse_down, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '.float * 1.1')
bind = $mainMod, mouse_up, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '(.float * 0.9) | if . < 1 then 1 else . end')
binde = $mainMod, equal, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '.float * 1.1')
binde = $mainMod, minus, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '(.float * 0.9) | if . < 1 then 1 else . end')
binde = $mainMod, KP_ADD, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '.float * 1.1')
binde = $mainMod, KP_SUBTRACT, exec, hyprctl -q keyword cursor:zoom_factor $(hyprctl getoption cursor:zoom_factor -j | jq '(.float * 0.9) | if . < 1 then 1 else . end')
bind = $mainMod SHIFT, mouse_up, exec, hyprctl -q keyword cursor:zoom_factor 1
bind = $mainMod SHIFT, mouse_down, exec, hyprctl -q keyword cursor:zoom_factor 1
bind = $mainMod SHIFT, minus, exec, hyprctl -q keyword cursor:zoom_factor 1
bind = $mainMod SHIFT, KP_SUBTRACT, exec, hyprctl -q keyword cursor:zoom_factor 1
bind = $mainMod SHIFT, 0, exec, hyprctl -q keyword cursor:zoom_factor 1

# --- FINAL ---
bind = ALT, Tab, cyclenext
bind = ALT, Tab, bringactivetotop
bind = $mainMod, G, togglegroup
exec = $HOME/dotfiles/share/scripts/auto-game-mode.sh &
exec-once = /home/n30/dotfiles/share/scripts/mangohud-song.sh &
exec-once = bash -c "sleep 3; QSG_RHI_BACKEND=opengl dms run"
exec-once = safeeyes